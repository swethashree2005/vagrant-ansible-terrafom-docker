<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Docker & Kubernetes Quiz</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css', v=5) }}">
</head>
<body>
<main class="screen">
  <section class="quiz-card">
    <h1>IaC Value Added Course Quiz</h1>

    <div class="progress">
      <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
      <div class="progress-text" id="progress-text"></div>
    </div>

    <form method="post" action="/submit" id="quiz-form">
      {% for q in questions %}
        <div class="question-container" id="question{{ q.id }}">
          <p><strong>{{ loop.index }}. {{ q.question }}</strong></p>
          {% for opt in q.options %}
            <label class="option">
              <input type="radio" name="q{{ q.id }}" value="{{ loop.index0 }}">
              <span class="opt-text">{{ opt }}</span>
            </label>
          {% endfor %}
        </div>
      {% endfor %}

      <div class="controls">
        <button type="button" id="prev-button" disabled>Previous</button>
        <button type="button" id="next-button" disabled>Next</button>
        <button type="submit" id="submit-button" class="hidden">Submit Quiz</button>
      </div>
    </form>
  </section>
</main>

<script>
  const questionContainers = document.querySelectorAll('.question-container');
  const prevButton = document.getElementById('prev-button');
  const nextButton = document.getElementById('next-button');
  const submitButton = document.getElementById('submit-button');
  const progressFill = document.getElementById('progress-fill');
  const progressText = document.getElementById('progress-text');
  const totalQuestions = questionContainers.length;

  let currentQuestionIndex = 0;

  function updateProgress(){
    const pct = ((currentQuestionIndex + 1) / totalQuestions) * 100;
    progressFill.style.width = pct + '%';
    progressText.textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;
  }

  function setNextEnabledFor(index){
    const radios = questionContainers[index].querySelectorAll('input[type="radio"]');
    nextButton.disabled = !Array.from(radios).some(r => r.checked);
  }

  function showQuestion(index){
    questionContainers.forEach((el, i)=>{
      el.style.display = i === index ? 'block' : 'none';
    });
    prevButton.disabled = index === 0;
    submitButton.classList.toggle('hidden', index !== totalQuestions - 1);
    nextButton.style.display = index === totalQuestions - 1 ? 'none' : 'inline-block';
    setNextEnabledFor(index);
    updateProgress();
  }

  function nextQuestion(){
    if(currentQuestionIndex < totalQuestions - 1){
      currentQuestionIndex++;
      showQuestion(currentQuestionIndex);
    }
  }
  function prevQuestion(){
    if(currentQuestionIndex > 0){
      currentQuestionIndex--;
      showQuestion(currentQuestionIndex);
    }
  }

  questionContainers.forEach((container, i)=>{
    container.addEventListener('change', (e)=>{
      if(i === currentQuestionIndex && e.target.type === 'radio'){
        nextButton.disabled = false;
      }
    });
  });

  prevButton.addEventListener('click', prevQuestion);
  nextButton.addEventListener('click', nextQuestion);

  questionContainers.forEach((c, i)=>{ if(i !== 0) c.style.display='none'; });
  showQuestion(currentQuestionIndex);
</script>
</body>
</html>
